name: Docs to PDF

on:
  workflow_dispatch:
  # Uncomment this section if you want the action to run on push to the main branch
  # push:
  #   branches:
  #     - main
  #   paths:
  #     - 'docs/**.md'
  #     - 'docs/images/**'

jobs:
  converttopdf:
    name: Build PDF
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: baileyjm02/markdown-to-pdf@v1
        with:
          input_dir: docs
          output_dir: pdfs
          images_dir: docs/images
          image_import: ./images
          build_html: false
      - uses: actions/upload-artifact@v3
        with:
          name: docs
          path: pdfs

  release:
    name: Create Release
    runs-on: ubuntu-latest
    needs: converttopdf
    steps:
      - uses: actions/checkout@v3
      
      # Download the artifact created in the previous job
      - name: Download PDF Artifact
        uses: actions/download-artifact@v3
        with:
          name: docs
          path: pdfs

      # Create a release and upload the PDF as an asset
      - name: Create GitHub Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v1.0.0  # Adjust as needed, or use a variable for dynamic versioning
          release_name: PDF Documentation Release
          body: |
            This release includes the latest PDF documentation.
          draft: false
          prerelease: false

      - name: Upload PDF to Release
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: docs
          asset_name: docs.zip  # Rename as appropriate
          asset_content_type: application/zip
